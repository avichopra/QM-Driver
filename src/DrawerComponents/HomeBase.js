let response1={
	geocoded_waypoints: [
	  {
	geocoder_status: "OK",
	place_id: "ChIJAbgWHwszEjkRgmrYI7wODhk",
	types: [
	  "route"
	],
	},
	  {
	geocoder_status: "OK",
	place_id: "ChIJV1dZdmwzEjkR3IwNlVoXPcA",
	types: [
	  "route"
	],
	}
	],
	routes: [
	  {
	bounds: {
	northeast: {
	lat: 29.14144349999999,
	lng: 75.7566769
	},
	southwest: {
	lat: 29.1323704,
	lng: 75.7430748
	}
	},
	copyrights: "Map data ©2019 Google",
	legs: [
	  {
	distance: {
	text: "2.2 km",
	value: 2239
	},
	duration: {
	text: "8 mins",
	value: 486
	},
	"end_address": "Gurudwara Rd, Model Town, Hisar, Haryana 125011, India",
	"end_location": {
	"lat": 29.1323704,
	"lng": 75.7430748
	},
	"start_address": "Gali Number 11, Surya Nagar, Hisar, Haryana 125005, India",
	"start_location": {
	"lat": 29.1397982,
	"lng": 75.75666079999999
	},
	"steps": [
	  {
	"distance": {
	"text": "54 m",
	"value": 54
	},
	"duration": {
	"text": "1 min",
	"value": 12
	},
	"end_location": {
	"lat": 29.1402793,
	"lng": 75.7566769
	},
	"html_instructions": "Head <b>north</b>",
	"polyline": {
	"points": "wjzpDcfkmM_BC"
	},
	"start_location": {
	"lat": 29.1397982,
	"lng": 75.75666079999999
	},
	"travel_mode": "DRIVING"
	},
	  {
	"distance": {
	"text": "0.1 km",
	"value": 124
	},
	"duration": {
	"text": "1 min",
	"value": 39
	},
	"end_location": {
	"lat": 29.1403797,
	"lng": 75.7554701
	},
	"html_instructions": "Turn <b>left</b> at Happy Kriyana And Confectionery Store",
	"maneuver": "turn-left",
	"polyline": {
	"points": "wmzpDgfkmM?x@?jA@J?\?PA\ADABCBKB"
	},
	"start_location": {
	"lat": 29.1402793,
	"lng": 75.7566769
	},
	"travel_mode": "DRIVING"
	},
	  {
	"distance": {
	"text": "0.6 km",
	"value": 573
	},
	"duration": {
	"text": "2 mins",
	"value": 130
	},
	"end_location": {
	"lat": 29.1412476,
	"lng": 75.7507758
	},
	html_instructions: "Slight <b>right</b><div style='font-size:0.9em'>Pass by Bharat Wooden works (on the left)</div>",
	maneuver: "turn-slight-right",
	polyline: {
	points: "knzpDu~jmMi@AwAC_ADG?C@C@A@?B?DDz@Dn@Dj@Br@FxABt@BvA@fA@bA?`@AfB@b@CjD"
	},
	start_location: {
	lat: 29.1403797,
	lng: 75.7554701
	},
	travel_mode: "DRIVING"
	},
	  {
	distance: {
	text: "0.8 km",
	value: 809
	},
	duration: {
	text: "3 mins",
	value: 158
	},
	end_location: {
	lat: 29.1345812,
	lng: 75.7475285
	},
	html_instructions: "Turn <b>left</b> at Dhaka Bldg Material onto <b>Jindal Chowk - Raipur Rd</b><div style='font-size:0.9em'>Pass by Goswami Ice Cream Point (on the left)</div>",
	maneuver: "turn-left",
	polyline: {
	points: "yszpDkajmMzBz@jA\HNHDTFv@XRA@?D@FBNDx@\BBxD|AhCfAv@ZxAl@XJ~D|AxChAnAf@"
	},
	start_location: {
	lat: 29.1412476,
	lng: 75.7507758
	},
	travel_mode: "DRIVING"
	},
	  {
	distance: {
	text: "0.3 km",
	value: 303
	},
	duration: {
	text: "1 min",
	value: 59
	},
	end_location: {
	lat: 29.135438,
	lng: 75.7446873
	},
	html_instructions: "Turn <b>right</b> at SBM Toilet onto <b>Mall Rd</b>/<b>Sirsa Rd</b><div style='font-size:0.9em'>Pass by SBM Toilet (on the left)</div>",
    maneuver: "turn-right",
	polyline: {
	points: "cjypDamimMNBEV]zCCNI\}@zCkAtD"
	},
	start_location: {
	lat: 29.1345812,
	lng: 75.7475285
	},
	travel_mode: "DRIVING"
	},
	  {
	distance: {
	text: "0.4 km",
	value: 376
	},
	duration: {
	text: "1 min",
	value: 88
	},
	end_location: {
	lat: 29.1323704,
	lng: 75.7430748
	},
	html_instructions: "Turn <b>left</b> onto <b>Gurudwara Rd</b><div style='font-size:0.9em'>Pass by सीए दीपक धनखड़ (on the left)</div><div style='font-size:0.9em'>Destination will be on the left</div>",
	maneuver: "turn-left",
	polyline: {
	points :"ooypDi{hmMt@Zt@TjAj@nBt@~BdARJnBz@`@PVN"
	},
	start_location: {
	lat: 29.135438,
	lng: 75.7446873
	},
	travel_mode: "DRIVING"
	}
	],
	traffic_speed_entry: [],
	via_waypoint: [],
	}
	],
	overview_polyline: {
		"points": "wjzpDcfkmM_BC?x@@vACrAEFKBi@AwAC_ADK@EB?HTjEJnCD~C@pFCjDzBz@jA\\HN^Lv@XRAF@VH`KfEjJrDhFpBNBEVa@jDgAxDkAtDt@Zt@TjAj@nFzBbCfAx@`@"
	},
	summary: "Jindal Chowk - Raipur Rd",
	warnings: [],
	waypoint_order: [],
	}
	],
	status: "OK"
	}
let response = {
	geocoded_waypoints: [
		{
			geocoder_status: 'OK',
			place_id: 'ChIJhSOe8XMzEjkRf-kr4fM7FnQ',
			types: [ 'bakery', 'establishment', 'food', 'lodging', 'point_of_interest', 'restaurant', 'store' ]
		},
		{
			geocoder_status: 'OK',
			place_id: 'ChIJAbgWHwszEjkRgmrYI7wODhk',
			types: [ 'route' ]
		}
	],
	routes: [
		{
			bounds: {
				northeast: {
					lat: 29.1414377,
					lng: 75.7566769
				},
				southwest: {
					lat: 29.1328376,
					lng: 75.74738710000001
				}
			},
			copyrights: 'Map data ©2019 Google',
			legs: [
				{
					distance: {
						text: '2.3 km',
						value: 2275
					},
					duration: {
						text: '8 mins',
						value: 466
					},
					end_address: 'Gali Number 11, Surya Nagar, Hisar, Haryana 125005, India',
					end_location: {
						lat: 29.1397982,
						lng: 75.75666079999999
					},
					start_address:
						'Opposite Vidyut Sadan O.P. Jindal Marg, Industrial Area, Vidyut Nagar, Hisar, Haryana 125005, India',
					start_location: {
						lat: 29.1328376,
						lng: 75.7537468
					},
					steps: [
						{
							distance: {
								text: '55 m',
								value: 55
							},
							duration: {
								text: '1 min',
								value: 15
							},
							end_location: {
								lat: 29.13332369999999,
								lng: 75.7538471
							},
							html_instructions:
								'Head <b>north</b> toward <b>Sirsa Rd</b><div style="font-size:0.9em">Pass by Mustard By Midtown (on the right)</div>',
							polyline: {
								points: 'g_ypD}sjmMc@G{@K'
							},
							start_location: {
								lat: 29.1328376,
								lng: 75.7537468
							},
							travel_mode: 'DRIVING'
						},
						{
							distance: {
								text: '0.6 km',
								value: 630
							},
							duration: {
								text: '2 mins',
								value: 107
							},
							end_location: {
								lat: 29.1345037,
								lng: 75.7475063
							},
							html_instructions:
								'Turn <b>left</b> at Indian Oil, Industrial Area, Hisar, Haryana onto <b>Sirsa Rd</b><div style="font-size:0.9em">Pass by Pepe Jeans (on the right)</div>',
							maneuver: 'turn-left',
							polyline: {
								points: 'gbypDqtjmMOtAStBW~B]`Dk@zE_@fDSjBK|@e@vE'
							},
							start_location: {
								lat: 29.13332369999999,
								lng: 75.7538471
							},
							travel_mode: 'DRIVING'
						},
						{
							distance: {
								text: '0.8 km',
								value: 828
							},
							duration: {
								text: '3 mins',
								value: 159
							},
							end_location: {
								lat: 29.141272,
								lng: 75.7506647
							},
							html_instructions:
								'Turn <b>right</b> at LG Electronics onto <b>Jindal Chowk - Raipur Rd</b><div style="font-size:0.9em">Pass by Police Booth (on the left)</div>',
							maneuver: 'turn-right',
							polyline: {
								points: 'siypD}limMEVMG[Ow@YkAe@qAi@iCaAo@WEAeDuAaBq@g@SyD_B}@]UIGEOKw@YUGIEQAiA]eBi@SG'
							},
							start_location: {
								lat: 29.1345037,
								lng: 75.7475063
							},
							travel_mode: 'DRIVING'
						},
						{
							distance: {
								text: '0.5 km',
								value: 512
							},
							duration: {
								text: '2 mins',
								value: 116
							},
							end_location: {
								lat: 29.1410273,
								lng: 75.75549579999999
							},
							html_instructions:
								'Turn <b>right</b><div style="font-size:0.9em">Pass by Bharat Wooden works (on the right in 450&nbsp;m)</div>',
							maneuver: 'turn-right',
							polyline: {
								points: '}szpDs`jmMBWBkDAc@@gB?a@AcAAgACwACu@GyACs@Ek@Eo@E{@?E?C@ABABAF?~@E'
							},
							start_location: {
								lat: 29.141272,
								lng: 75.7506647
							},
							travel_mode: 'DRIVING'
						},
						{
							distance: {
								text: '88 m',
								value: 88
							},
							duration: {
								text: '1 min',
								value: 20
							},
							end_location: {
								lat: 29.1410044,
								lng: 75.7563988
							},
							html_instructions: 'Turn <b>left</b>',
							maneuver: 'turn-left',
							polyline: {
								points: 'mrzpD{~jmMDsD'
							},
							start_location: {
								lat: 29.1410273,
								lng: 75.75549579999999
							},
							travel_mode: 'DRIVING'
						},
						{
							distance: {
								text: '81 m',
								value: 81
							},
							duration: {
								text: '1 min',
								value: 23
							},
							end_location: {
								lat: 29.1402774,
								lng: 75.7563945
							},
							html_instructions: 'Turn <b>right</b>',
							maneuver: 'turn-right',
							polyline: {
								points: 'grzpDodkmM|@@pA?'
							},
							start_location: {
								lat: 29.1410044,
								lng: 75.7563988
							},
							travel_mode: 'DRIVING'
						},
						{
							distance: {
								text: '27 m',
								value: 27
							},
							duration: {
								text: '1 min',
								value: 10
							},
							end_location: {
								lat: 29.1402793,
								lng: 75.7566769
							},
							html_instructions: 'Turn <b>left</b>',
							maneuver: 'turn-left',
							polyline: {
								points: 'wmzpDmdkmM?y@'
							},
							start_location: {
								lat: 29.1402774,
								lng: 75.7563945
							},
							travel_mode: 'DRIVING'
						},
						{
							distance: {
								text: '54 m',
								value: 54
							},
							duration: {
								text: '1 min',
								value: 16
							},
							end_location: {
								lat: 29.1397982,
								lng: 75.75666079999999
							},
							html_instructions:
								'Turn <b>right</b> at Happy Kriyana And Confectionery Store<div style="font-size:0.9em">Destination will be on the left</div>',
							maneuver: 'turn-right',
							polyline: {
								points: 'wmzpDgfkmM~AB'
							},
							start_location: {
								lat: 29.1402793,
								lng: 75.7566769
							},
							travel_mode: 'DRIVING'
						}
					],
					traffic_speed_entry: [],
					via_waypoint: []
				}
			],
			overview_polyline: {
				points:
					'g_ypD}sjmM_BSc@jEaCdTkAxKmDwAqGeCiN{F{Am@gAe@_@MQAiA]yBq@BWBkD?kCGeGUoFKuBDCJA~@EDsD|@@pA??y@~AB'
			},
			summary: 'Sirsa Rd and Jindal Chowk - Raipur Rd',
			warnings: [],
			waypoint_order: []
		}
	],
	status: 'OK'
};
import _ from 'lodash';
import { Component } from 'react';
import PolyLine from '@mapbox/polyline';
import { Dimensions } from 'react-native';
// import LocationServicesDialogBox from 'react-native-android-location-services-dialog-box';
import RNGooglePlaces from 'react-native-google-places';
import { AnimatedRegion,Polyline } from 'react-native-maps';
import getDirections from 'react-native-google-maps-directions';
import call from 'react-native-phone-call';
import { setDriver } from '../redux';
import {unSubscribeSockets,saveSubscriptionInfo} from "../utilities/socket"
import GPSState from 'react-native-gps-state'
import RNAndroidLocationEnabler from 'react-native-android-location-enabler';
import { addLocation ,cancelPatientLocationCoord,saveTrip,patientTempData,addPatientLocationCoord,addHospitalLocationCoord,cancelTrip,addAmbulanceCoord} from '../redux/actions/index';
import { setPatient} from '../redux/index';
import Store from '../redux/store/index';
import { callApi } from '../utilities/serverApi';
import TempStorage from '../utilities/tempStorage';
const { width, height } = Dimensions.get('window');
let latitude_delta=0.009,longitude_delta=0.009;
export default class HomeBase extends Component {
	constructor(props) {
		super(props);
		this.state = {
			latitude: 0,
			longitude: 0,
			latitudeDelta: 0,
			longitudeDelta: 0,
			currentPlace: '',
			loading: true,
			accept: false,
			reject: false,
			patient: null,
			showAcceptDecline: false,
			showReasons: false,
			coordinate: new AnimatedRegion({
				latitude: 29.1397982,
				longitude: 75.75666079999999
			}),
			destination: new AnimatedRegion({
				latitude: 29.1397982,
				longitude: 75.75666079999999
			}),
			showdes: false,
			pointCoords: [],
			showPatientLocation:false,
		showHospital:false,
		markComplete:false,
angle:200
		};
	
	}
	Call = (Type) => {
		console.log("type",Type)
		const args = {
			number: Type === 'CN' ? this.props.trip.hospitalNo : Type,
			prompt: false 
		};
		call(args).catch(console.error);
	};
	onShowReasons = (value) => {
		this.setState({ showReasons: value });
	};
	markComplete=()=>{
		console.warn("Completed")
		Store.dispatch(cancelTrip());
		let headers = {
			'Content-Type': 'application/json',
			Accept: 'application/json',
			authorization: `Bearer ${this.props.token}`
		};
		let data = {
			driverData: this.props.trip.driverId.userId._id,
			patientData:this.props.trip.patientId.userId._id
		};
		callApi('post', 'v1/daffo/dispatch/tripCompleted', data, headers)
			.then((response) => {
				console.log('response', response);
			})
			.catch((err) => {
				console.log('error from home base', err);
			});
	}
	navigationMap=async()=>{
	  console.log("Navigation map data",this.props.trip)
		let data;
		 this.props.trip.pickedPatient?
		 data = {
			source: {
			 latitude: parseFloat(this.props.trip.patientLocation.lat) ,
			 longitude: parseFloat(this.props.trip.patientLocation.long)
		   },
		   destination: {
			 latitude:  parseFloat(this.props.trip.hospitalLocation.lat),
			 longitude: parseFloat(this.props.trip.hospitalLocation.long)
		   },
		   params: [
			 {
			   key: "travelmode",
			   value: "driving"     
			 }
		   ]
		 }
:  data = { source: {
	latitude: this.state.latitude ,
	longitude: this.state.longitude
  },
  destination: {
	latitude: parseFloat(this.props.trip.patientLocation.lat),
	longitude: parseFloat(this.props.trip.patientLocation.long)
  },
  params: [
	{
	  key: "travelmode",
	  value: "driving"     
	}
  ]}
  console.log("data before navigation",data)
		 getDirections(data)
	}

	 componentWillReceiveProps(nextProps)
	{
		if(nextProps.trip!=null)
		{console.log("Inside component receive props",nextProps)
		   if(nextProps.pickedLocationCoord===null)
		   { 
			if(nextProps.trip.pickedPatient===false)
			 this.getPickupRouteDirection(nextProps.trip.patientLocation)
		   }
		   if(nextProps.hospitalLocationCoord===null)
		   {
		     this.getHospitalRouteDirection(nextProps.trip.hospitalLocation)
		   }
		//    this.props.gpsData===null && this.props.pickedLocationCoord !=null && this.props.hospitalLocationCoord!=null && this.map.fitToCoordinates([...nextProps.pickedLocationCoord,...nextProps.hospitalLocationCoord]);
		}
		if(this.props.gpsData!=nextProps.gpsData)
		{
			this.desmarker._component.animateMarkerToCoordinate(
				{
				latitude: parseFloat(nextProps.gpsData.latitude),
				longitude: parseFloat(nextProps.gpsData.longitude)
				},
				2000
				);
				let newCoordinate={latitude:parseFloat(nextProps.gpsData.latitude),longitude:parseFloat(nextProps.gpsData.longitude),latitudeDelta:latitude_delta,longitudeDelta:longitude_delta}
				this.map.animateToRegion(newCoordinate, 1000);
		}
		}
	     getPickupRouteDirection=async (data)=>{
			//   const response=await fetch(`https://maps.googleapis.com/maps/api/directions/json?origin=${this.state.latitude},${this.state.longitude}&destination=Universal+Studios+Hollywood&key=AIzaSyD9fameWCeX54X9WwqIKmp6x_S13v9a49g`
					//   const json=response.json();
					const points = PolyLine.decode(response.routes[0].overview_polyline.points);
					let pointCoords = points.map((point) => {
						return { latitude: point[0], longitude: point[1] };
					});
					await Store.dispatch(addPatientLocationCoord(pointCoords,{distance:response.routes[0].legs[0].distance.text,duration:response.routes[0].legs[0].duration.text}))
					if(this.props.trip===null)
					this.map.fitToCoordinates(pointCoords);
					console.log("Point Coords",pointCoords)
				}
	      getHospitalRouteDirection=async (data)=>{
					//   const response=await fetch(`https://maps.googleapis.com/maps/api/directions/json?origin=${this.state.latitude},${this.state.longitude}&destination=Universal+Studios+Hollywood&key=AIzaSyD9fameWCeX54X9WwqIKmp6x_S13v9a49g`
					//   const json=response.json();
					const points = PolyLine.decode(response1.routes[0].overview_polyline.points);
					let pointCoords = points.map((point) => {
						return { latitude: point[0], longitude: point[1] };
					});
					await Store.dispatch(addHospitalLocationCoord(pointCoords,{distance:response1.routes[0].legs[0].distance.text,duration:response1.routes[0].legs[0].duration.text}))
				}
	onAccept = async() => {
		let headers = {
			'Content-Type': 'application/json',
			Accept: 'application/json',
			authorization: `Bearer ${this.props.token}`
		};
		let { currentPlace = '', latitude = '', longitude = '' } = this.state;
		let {  user = {},patientTempData={}} = this.props;
		await unSubscribeSockets("Trip");
		await saveSubscriptionInfo("TripInProgress",[])
		// _.remove(patientTempData.allDrivers, (item) => item === this.props.user.id);
		this.setState({ accept: true, reject: false });
		console.warn("user data on Accept",user.id)
		let data = {
			patient: {RequestData:patientTempData.patient.RequestData,patientId:patientTempData.patient.userId,patientLocation:{currentPlace:patientTempData.location.currentPlace,latitude:patientTempData.location.latitude,longitude:patientTempData.location.longitude}},
			// allDrivers: patientTempData.allDrivers,
			driver:{deviceId:user.deviceId,driverId:user.id,driverLocation:{currentPlace:currentPlace,latitude:latitude,longitude:longitude}},
				};
		callApi('post', 'v1/daffo/dispatch/ambulanceRequestAccepted', data, headers)
			.then((response) => {
				Store.dispatch(saveTrip(response.data.trip))
				unSubscribeSockets("TripInProgress")
				console.log('response', response);
			})
			.catch((err) => {
				console.log('error from home base', err);
			});
	};
	onReject = () => {
		this.setState({ showReasons: true });
	};
	onSubmit = async(value) => {
		this.setState({ showReasons: false });
		Store.dispatch(cancelTrip())
		await unSubscribeSockets("Trip");
	};
onClickPickPatient=async()=>
{
	let headers = {
		'Content-Type': 'application/json',
		Accept: 'application/json',
		authorization: `Bearer ${this.props.token}`
	};
	let data = {
		driverData: this.props.trip.driverId,
		patientData:this.props.trip.patientId
	};
	// Store.dispatch(addPatientLocationCoord(null));
	await Store.dispatch(cancelPatientLocationCoord())
	callApi('post', 'v1/daffo/dispatch/pickedUpPatient', data, headers)
			.then((response) => {
				console.log('response', response);
				Store.dispatch(saveTrip(response.data.trip))
			})
			.catch((err) => {
				console.log('error from home base', err);
			});
}
	componentWillUnmount() {
		navigator.geolocation.clearWatch(this.watchID);
		GPSState.removeListener()
	}
	openDrawer = () => {
		console.log('open drawer being called>>>>>>>>>>>>>>>>>>>>');
		this.props.navigation.openDrawer();
	};
	// getRouteDirection = async () => {
	// 	try {
	// 		// this.setState({showdes:true})
	// 		//   const response=await fetch(`https://maps.googleapis.com/maps/api/directions/json?origin=${this.state.latitude},${this.state.longitude}&destination=Universal+Studios+Hollywood&key=AIzaSyD9fameWCeX54X9WwqIKmp6x_S13v9a49g`)

	// 		//   const json=response.json();
	// 		//   console.log("response for map")
	// 		//   console.log("in json",json)
	// 		// console.log('inside route direction', response1.results.trips[0].pts);
	// 		console.log('data in response', response.routes[0]);
	// 		const points = PolyLine.decode(response.routes[0].overview_polyline.points);
	// 		console.log('Polyline points', points);
	// 		let pointCoords = points.map((point) => {
	// 			return { latitude: point[0], longitude: point[1] };
	// 		});
	// 		//   console.log("state for route",this.state.pointCoords)
	// 		let destination = {
	// 			latitude: response.routes[0].legs[0].end_location.lat,
	// 			longitude: response.routes[0].legs[0].end_location.lng
	// 		};
	// 		this.setState({ pointCoords: pointCoords, destination });
	// 		console.log('points coords in state', this.state.pointCoords);
	// 		console.log('points coord', pointCoords);
	// 		this.map.fitToCoordinates(pointCoords);
	// 		// if(this.props.showAcceptDecline===false && this.props.patient!=null)
	// 		// {
	// 			console.warn("calling animate")
	// 		this.animateAmbulace()
	// 		// }
	// 		// this.map.animateToRegion({pointCoords,latitudeDelta:latitude_delta,longitudeDelta:longitude_delta}, 2000)
	// 		// let pointcoord = [ ...pointCoords ].reverse();
	// 		// pointcoord.map((points,index)=>{
	// 		// let i = 0;
	// 		// this.timer = setInterval(() => {
	// 		// 	this.desmarker &&
	// 		// 		pointCoords[i] &&
	// 		// 		this.desmarker._component.animateMarkerToCoordinate(
	// 		// 			{
	// 		// 				latitude: pointCoords[i].latitude,
	// 		// 				longitude: pointCoords[i].longitude
	// 		// 			},
	// 		// 			2000
	// 		// 		);
	// 		// 	// console.warn("inside timer",pointcoord[i]);
	// 		// 	if (pointCoords[i] === undefined) clearInterval(this.timer);
	// 		// 	i++;
	// 		// }, 2000);
	// 		//   console.warn("inside map timer", +new Date());
	// 		// })
	// 	} catch (error) {
	// 		console.log(error);
	// 	}
	// };
	componentWillMount() {
		console.warn('Location in redux', this.props.location);
		if(this.props.showAcceptDecline===false && this.props.patient!=null)
		    this.setState({destination:{latitude:this.props.patientLocation.latitude,longitude:this.props.patientLocation.longitude}})
		if (this.props.location != null) {
			this.setState({
				loading: false,
				latitude: this.props.location.latitude,
				longitude: this.props.location.longitude
			});
		}
		let headers = {
			'Content-Type': 'application/json',
			Accept: 'application/json',
			authorization: `Bearer ${this.props.token}`
		};
		let data={perPage:1,fields:{ambulanceId:{vehicleNo:1}},filter:{driverId:this.props.user.id}}
		console.warn('token', this.props.token);
		Promise.all([callApi('post', 'v1/daffo/AssignAmbulance/getOwn', data, headers),callApi('post', 'v1/daffo/Driver/getOwn', { perPage: 1, filter: { userId: this.props.user.id } }, headers)])
			.then((result) => {
				console.log("results=========>>>>>>>>>>>>>",result)
				 setDriver({...result[1].data[0],ambulanceDetails:result[0].data[0].ambulanceId});
			})
			.catch((err) => {
				console.log('errorrrrrrr>>>>>>>>>', err);
			});
	}
	checkLocationIsEnabled=()=>{
		RNAndroidLocationEnabler.promptForEnableLocationIfNeeded({interval: 10000, fastInterval: 5000})
		.then(data => {
					RNGooglePlaces.getCurrentPlace()
				.then((results) => {
					Store.dispatch(addLocation({ latitude: results[0].latitude, longitude: results[0].longitude }));
					this.setState({
						loading: false,
						currentPlace: `${results[0].name},${results[0].address}`,
						latitude: results[0].latitude,
						longitude: results[0].longitude
					});
					console.warn('current place', results);
				})
				.catch((error) => console.warn(error.message));
		})
	}
	componentDidMount() {
		this.checkLocationIsEnabled()
		GPSState.addListener((status)=>{
	console.warn("location state",status)
		 if(status===1)
		 {
		this.checkLocationIsEnabled()
		 }
		})
		this.watchID = navigator.geolocation.watchPosition(
			(position) => {
				console.warn('location changed');
				this.setState({
					latitude: position.coords.latitude,
					longitude: position.coords.longitude
				});
				// this._map.animateToRegion(region, 100);
				let newCoordinate={latitude:position.coords.latitude,longitude:position.coords.longitude,latitudeDelta:latitude_delta,longitudeDelta:longitude_delta}
				// this.map.animateToRegion(newCoordinate, 1000);
			},
			function(error) {
				console.warn(error);
			},
			{ enableHighAccuracy: true, timeout: 20000, maximumAge: 1000 }
		);
	}
	setUserLocation = (Coordinate) => {
		const { latitude, longitude } = Coordinate;
		const newCoordinate = {
			latitude,
			longitude,
			latitudeDelta:latitude_delta,
			longitudeDelta:longitude_delta
		};
	// console.warn("set user >>>>>",newCoordinate)
	// this.animateMap(newCoordinate);
	// if(this.map)
	// {
	// let region={latitude:Coordinate.latitude,longitude:Coordinate.longitude,latitudeDelta:latitude_delta,longitudeDelta:longitude_delta}
	
	if(this.props.trip===null && this.props.pickedLocationCoord===null)
	{
		const newCoordinate = {
			latitude,
			longitude,
			latitudeDelta:latitude_delta,
			longitudeDelta:longitude_delta
		};
		this.map.animateToRegion(newCoordinate, 1000);
	}
// }	
};
// animateMap=()=>{
// 	this._map.animateToRegion(region, 100)
// }
	onRegionChangeComplete = (region) => {
		latitude_delta = region.latitudeDelta;
		longitude_delta = region.longitudeDelta;
		// this._map.animateToRegion(region, 100);
	};
	AutoCom = () => {
		RNGooglePlaces.openAutocompleteModal({ country: 'IN', radius: 100 })
			.then((place) => {
				this.setState({
					currentPlace: place.address,
					latitude: place.latitude,
					longitude: place.longitude
				});
				console.log(place.latitude);
			})
			.catch((error) => console.log(error.message));
	};
}
